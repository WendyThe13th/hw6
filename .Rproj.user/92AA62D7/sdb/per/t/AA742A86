{
    "collab_server" : "",
    "contents" : "\n---\ntitle: \"nyc_restaurant_shiny\"\nauthor: \"Mengqi Zhu\"\ndate: \"2017/11/15\"\noutput: \n  flexdashboard::flex_dashboard:\n    orientation: row\n  runtime: shiny\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\nlibrary(flexdashboard)\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(stringr)\nlibrary(forcats)\nlibrary(plotly)\nlibrary(shiny)\n```\n\n```{r}\n#read and clean data\nnyc_inspections <- \n  read_csv(\"../data/DOHMH_New_York_City_Restaurant_Inspection_Results.csv.gz\", \n                           col_types = cols(building = col_character()),\n                           na = c(\"NA\", \"N/A\")) %>%\n  clean_names() %>%\n  filter(grade %in% c(\"A\", \"B\", \"C\"),\n         boro != \"Missing\") %>% \n  mutate(inspection_num = row_number(),\n         boro = str_to_title(boro)) %>% \n  select(inspection_num, boro, grade, score, critical_flag, cuisine_description)\n```\n\n\nColumn {.sidebar}\n-----------------------------------------------------------------------\n\n```{r, siderbar}\nboros <- \n  nyc_inspections %>% distinct(boro) %>% pull()\n\ncuisines <- \n  nyc_inspections %>% distinct(cuisine_description) %>% pull()\n\n#radioButtons widget\nradioButtons(\"boro_choice\", label = h3(\"Select boro\"),\n             choices = boros, selected = \"Manhattan\")\n\n\n#sliderInput widget\nmax_A_pecent <- 1\nmin_A_percent <- 0\nsliderInput(\"pecent_A\", label = h3(\"Choose A% range\"), \n            min = min_A_percent, max = max_A_pecent, value = c(0.2, 0.8))\n\n```\n\n\nRow\n-----------------------------------------------------------------------\n\n### Chart A\n\n```{r, chartA}\nrenderPlotly({\n  nyc_inspections %>%\n  group_by(boro, cuisine_description) %>%\n  summarise(aver_score = mean(score),\n            num_inspections = n(),\n            A_num = sum(grade == \"A\"),\n            A_percent = sum(grade == \"A\")/n(),\n            critaical_percent = sum(grade == \"A\")/n()) %>%\n  filter(boro == input$boro_choice, \n         A_percent %in% input$pecent_A[1]:input$pecent_A[2]) %>%\n  mutate(text_label = str_c(\"Boro: \", boro, '\\nCuisine: ', cuisine_description, \n                            '\\nnumber of inspection:', num_inspections, '\\nnumber of A:', A_num,\n                            '\\n A%:', paste(round(A_percent*100,digits = 2),\"%\",sep = \"\")), \n                            '\\n critical%:', paste(round(critaical_percent*100,digits = 2),\"%\",sep = \"\")) %>%\n  plot_ly(x = ~A_percent, y = ~aver_score, type = \"scatter\", mode = \"markers\",   \n          alpha = 0.7, color = ~boro, text = ~text_label)\n})\n```\n\nRow {.tabset .tabset-fade}\n-----------------------------------------------------------------------\n\n### Chart B\n\n```{r, chartB}\nrenderPlotly({\ncuisine_boxplot <-\n  nyc_inspections %>%\n  filter(boro == input$boro_choice) %>%\n  group_by(cuisine_description) %>%\n  summarise(num_inspections = n()) %>%\n  top_n(5, num_inspections) %>%\n  pull(cuisine_description)\nnyc_inspections %>%\n  filter(boro == input$boro_choice,\n         cuisine_description %in% cuisine_boxplot) %>%\n  plot_ly(y = ~score, color = ~cuisine_description, type = \"box\", colors = \"Set2\")\n})\n```\n\n### Chart C\n\n```{r, chartC}\nrenderPlotly({\n  nyc_inspections %>%\n  group_by(boro, cuisine_description) %>%\n  summarise(aver_score = mean(score),\n            num_inspections = n(),\n            A_num = sum(grade == \"A\"),\n            A_percent = sum(grade == \"A\")/n(),\n            critaical_percent = sum(grade == \"A\")/n()) %>%\n  mutate(text_label = str_c(\"Boro: \", boro, '\\nCuisine: ', cuisine_description, \n                            '\\nnumber of inspection:', num_inspections, '\\nnumber of A:', A_num,\n                            '\\n A%:', paste(round(A_percent*100, digits = 2),\"%\",sep = \"\")), \n                            '\\n critical%:', paste(round(critaical_percent*100, digits = 2),\"%\",sep = \"\")) %>%\n  filter(boro == \"Manhattan\",\n         A_percent %in% input$pecent_A[1]:input$pecent_A[2]) %>%\n  plot_ly(x = ~cuisine_description, y = ~aver_score, color = ~cuisine_description, type = \"bar\", text = ~text_label) %>%\n  layout(showlegend = FALSE)\n})\n```",
    "created" : 1510885125397.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3492780411",
    "id" : "AA742A86",
    "lastKnownWriteTime" : 1510885247,
    "last_content_update" : 1510885247654,
    "path" : "D:/Study/2017 Fall/Data Science/作业/hw6/nyc_restaurant_shiny.Rmd",
    "project_path" : "nyc_restaurant_shiny.Rmd",
    "properties" : {
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}
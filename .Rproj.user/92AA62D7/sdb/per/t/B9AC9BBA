{
    "collab_server" : "",
    "contents" : "---\ntitle: \"nyc_restaurant_flexboard\"\nauthor: \"Mengqi Zhu\"\ndate: \"November 13, 2017\"\noutput: \n  flexdashboard::flex_dashboard:\n    orientation: columns\n    vertical_layout: fill\n---\n\n```{r setup, include=FALSE}\nrm(list = ls())\nlibrary(readxl)\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(stringr)\nlibrary(plotly)\nlibrary(flexdashboard)\n```\n\n\n```{r, chunk1}\n#read and clean data\nnyc_inspections <- \n  read_csv(\"../data/DOHMH_New_York_City_Restaurant_Inspection_Results.csv.gz\", \n                           col_types = cols(building = col_character()),\n                           na = c(\"NA\", \"N/A\")) %>%\n  clean_names() %>%\n  filter(grade %in% c(\"A\", \"B\", \"C\"),\n         boro != \"Missing\") %>% \n  mutate(inspection_num = row_number(),\n         boro = str_to_title(boro)) %>% \n  select(inspection_num, boro, grade, score, critical_flag, cuisine_description)\n```\n\nColumn {data-width=500}\n-----------------------------------------------------------------------\n\n### Chart A\n\n```{r, chunk2, message = FALSE, warning = FALSE}\nnyc_inspections %>%\n  group_by(boro, cuisine_description) %>%\n  summarise(aver_score = mean(score),\n            num_inspections = n(),\n            A_num = sum(grade == \"A\"),\n            A_percent = sum(grade == \"A\")/n(),\n            critaical_percent = sum(grade == \"A\")/n()) %>%\n  mutate(text_label = str_c(\"Boro: \", boro, '\\nCuisine: ', cuisine_description, \n                            '\\nnumber of inspection:', num_inspections, '\\nnumber of A:', A_num,\n                            '\\n A%:', paste(round(A_percent*100,digits = 2),\"%\",sep = \"\")), \n                            '\\n critical%:', paste(round(critaical_percent*100,digits = 2),\"%\",sep = \"\")) %>%\n  plot_ly(x = ~A_percent, y = ~aver_score, type = \"scatter\", mode = \"markers\",   \n          alpha = 0.7, color = ~boro, text = ~text_label)\n\n\n```\n\nColumn {data-width=450}\n-----------------------------------------------------------------------\n\n### Chart B\n\n```{r, chunk3}\n\ncuisine_boxplot <-\n  nyc_inspections %>%\n  filter(boro == \"Manhattan\") %>%\n  group_by(cuisine_description) %>%\n  summarise(num_inspections = n()) %>%\n  top_n(5, num_inspections) %>%\n  pull(cuisine_description)\n\nnyc_inspections %>%\n  filter(boro == \"Manhattan\",\n         cuisine_description %in% cuisine_boxplot) %>%\n  plot_ly(y = ~score, color = ~cuisine_description, type = \"box\", colors = \"Set2\")\n```\n\n### Chart C\n\n```{r, chunk4, message = FALSE, warning =FALSE}\nnyc_inspections %>%\n  group_by(boro, cuisine_description) %>%\n  summarise(aver_score = mean(score),\n            num_inspections = n(),\n            A_num = sum(grade == \"A\"),\n            A_percent = sum(grade == \"A\")/n(),\n            critaical_percent = sum(grade == \"A\")/n()) %>%\n  mutate(text_label = str_c(\"Boro: \", boro, '\\nCuisine: ', cuisine_description, \n                            '\\nnumber of inspection:', num_inspections, '\\nnumber of A:', A_num,\n                            '\\n A%:', paste(round(A_percent*100, digits = 2),\"%\",sep = \"\")), \n                            '\\n critical%:', paste(round(critaical_percent*100, digits = 2),\"%\",sep = \"\")) %>%\n  filter(boro == \"Manhattan\") %>%\n  plot_ly(x = ~cuisine_description, y = ~aver_score, color = ~cuisine_description, type = \"bar\", text = ~text_label) %>%\n  layout(showlegend = FALSE)\n```\n\n\n\n",
    "created" : 1510885116198.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2028961689",
    "id" : "B9AC9BBA",
    "lastKnownWriteTime" : 1510885200,
    "last_content_update" : 1510885200186,
    "path" : "D:/Study/2017 Fall/Data Science/作业/hw6/nyc_restaurant_flexboard.Rmd",
    "project_path" : "nyc_restaurant_flexboard.Rmd",
    "properties" : {
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}